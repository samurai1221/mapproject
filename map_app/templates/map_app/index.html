{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>–ö–∞—Ä—Ç–∞ —Å –º–æ–∏–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º</title>
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#1976d2">
    <link rel="icon" href="{% static 'icons/icon-192x192.png' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100vh;
        width: 100%;
      }
      #locate-btn {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 5;
        background: white;
        border: none;
        border-radius: 8px;
        padding: 10px 15px;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      }
      #locate-btn:hover {
        background: #f1f1f1;
      }
    </style>
  </head>
  <body>
    <button id="locate-btn">üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
    <div id="map"></div>

    <script>
      let map;
      let userMarker;

      function initMap() {
        const center = { lat: 43.238949, lng: 76.889709 }; // –ê–ª–º–∞—Ç—ã
        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: center,
        });

        const marker = new google.maps.Marker({
          position: center,
          map: map,
          title: "–ê–ª–º–∞—Ç—ã",
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        document.getElementById("locate-btn").addEventListener("click", () => {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              (position) => {
                const userPos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude,
                };

                if (userMarker) {
                  userMarker.setMap(null);
                }

                userMarker = new google.maps.Marker({
                  position: userPos,
                  map: map,
                  title: "–í—ã –∑–¥–µ—Å—å",
                  icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 8,
                    fillColor: "#4285F4",
                    fillOpacity: 1,
                    strokeWeight: 2,
                    strokeColor: "#ffffff",
                  },
                });

                map.setCenter(userPos);
                map.setZoom(14);
              },
              () => {
                alert("‚ö†Ô∏è –†–∞–∑—Ä–µ—à–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.");
              }
            );
          } else {
            alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.");
          }
        });
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap"
      async defer>
    </script>

  </body>
</html>
